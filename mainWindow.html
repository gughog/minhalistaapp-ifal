<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <!--MaterializeCSS-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--end_MaterializeCSS-->
        <title> :: Minha Lista :: </title>
    </head>
    <body id="body" class="">
        
        <nav>
            <div class="nav-wrapper light-blue darken-4">
                <a class="brand-logo center">
                    MinhaLista <i class="large material-icons">library_books</i>
                </a>
            <!--           
                <a class="brand-logo right" id="toggleColor">
                    <i class="large material-icons">lightbulb_outline</i>
                </a>
            -->
            </div>
        </nav>

        <ul>
            <!-- items goes here -->
        </ul>

        <script>
            const electron = require('electron')
            const fs = require('fs')
            const { ipcRenderer } = electron
            const ul = document.querySelector('ul')
            let itemsAdded = []
            let db = require('./database.json')

            // Add item --------------------------------------
            ipcRenderer.on('item:add', (e, item)=>{
                const li = document.createElement('li')
                const itemText = document.createTextNode(item)

                // inserting to the dom
                li.className = 'collection-item'
                li.appendChild(itemText)
                ul.className = 'collection'
                ul.appendChild(li)
    
                //Add to an array
                itemsAdded.push(item)

                console.log()

                // writing out to json
                fs.readFile("./database.json", (err, prevData)=>{
                    let data = JSON.parse(prevData)
                    data.push(itemsAdded)

                    // filtering duplicated items:
                    filteredData = data.flat().filter((element, pos)=>{
                        return data.flat().indexOf(element) == pos
                    })

                    // Writing in file
                    fs.writeFile("./database.json", JSON.stringify(filteredData), (err)=>{
                        if(err){
                            //error handle
                            M.toast({
                                html: `Erro ${err} ocorreu!`,
                                classes: "red darken-4 white-text"
                            })
                        }

                        //alert('Saved to database!')
                        M.toast({
                            html: 'Item salvo!',
                            classes: "green darken-1 white-text"
                        })
                    })
                })

                //Rendering from array
                
            })

            // Clear all -------------------------------------
            ipcRenderer.on('item:clear', ()=>{
                ul.innerHTML = ''
            })

            // Clear one on DoubleClick ----------------------
            let clearOnDoubleClick = (e) =>{
                e.target.remove()
                if(ul.children.length == 0){
                    ul.className = ''
                }
            }

            ul.addEventListener('dblclick', clearOnDoubleClick)

            // Dark mode -------------------------------------
            //const docBody = document.querySelector('#body')
            //const toggleButton = document.querySelector('#toggleColor')
            /*
            let setToDark = () =>{
                const li = document.querySelector('li')
                docBody.className = 'grey darken-3 white-text'
                li.className = 'collection-item grey darken-3 white-text'
                
            }
            */
            //toggleButton.style.cursor = 'pointer'
            //toggleButton.addEventListener('click', setToDark)

        </script>

    </body>
</html>